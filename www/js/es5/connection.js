"use strict";System.register(["./fsm","./state","./lang"],function(e,n){function o(e){if(3===v.state||2===v.state){if(1!==y.readyState)return void console.warn("Attempting to send while socket closed");l.debug&&console.log("<",e),y.send(e)}}function t(e){var n=e.data;l.debug&&console.log(">",n);var o=m[n[0]];o&&o(n.slice(1))}function i(e){p.textContent=g.sync[e]}function c(){return s(),"file:"==window.location.protocol?void console.error("Page downloaded locally. Refusing to sync."):(y=new WebSocket(T),y.binaryType="arraybuffer",y.onopen=v.feeder(1),y.onclose=v.feeder(2),y.onmessage=t,y.onerror=r,void(l.debug&&(window.socket=y)))}function r(e){console.error(e)}function s(){y&&(y.onclose=y.onmessage=y.onopen=y.onclose=y.onerror=null)}function a(){b&&(clearTimeout(b),b=0),h=0}function u(){v.feed(0)}function d(){6!==v.state&&navigator.onLine&&v.feed(3)}var f,l,g,w,m,v,y,h,b,p,T;n&&n.id;return e("send",o),e("start",u),{setters:[function(e){f=e},function(e){l=e},function(e){g=e}],execute:function(){e("message",w={}),e("handlers",m={}),e("connSM",v=new f["default"](0)),p=document.getElementById("sync"),v.act([0],0,1,function(){i(1),h=0,c()}),T=("https"===location.protocol?"wss":"ws")+("://"+location.host+"/socket"),v.act([1,4],1,2,function(){i(1),b=setTimeout(function(){return a()},1e4)}),v.wildAct(2,5,function(e){s(),l.debug&&console.error(e),b&&(clearTimeout(b),b=0),i(0);var n=500*Math.pow(1.5,Math.min(Math.floor(++h/2),12));setTimeout(v.feeder(3),n)}),v.act([5],3,4,function(){c(),setTimeout(function(){4===v.state&&i(1)},100)}),document.addEventListener("visibilitychange",function(e){e.target.hidden||d()}),window.addEventListener("online",function(){a(),v.feed(3)}),window.addEventListener("offline",v.feeder(2))}}});
//# sourceMappingURL=maps/connection.js.map
