{"version":3,"sources":["main.js","main.ts"],"names":["System","register","exports_1","context_1","start","__awaiter","this","regeneratorRuntime","mark","_callee","wrap","_context","prev","next","db_1","open","state_2","loadFromDB","connection_1","defer_1","exec","state_1","displayLoading","stop","options","o","cookieVersion","id","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","e","rejected","result","done","then","apply","setters","options_1","state_1_1","defer_1_1","connection_1_1","db_1_1","execute","localStorage","getItem","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","document","cookie","split","Symbol","iterator","eqPos","indexOf","name","substr","err","setItem","toString"],"mappings":"AAAA,YAAAA,QAAOC,UAAU,YAAa,UAAW,UAAW,eAAgB,QAAS,SAASC,EAAWC,GC2BjG,QAAAC,KDbQ,MAAOC,GAAUC,KAAM,OAAQ,OAAMC,mBAAAC,KAAE,QAAAC,KAoBnC,MAAOF,oBAAmBG,KAAK,SAAkBC,GAC7C,OACI,OAAQA,EAASC,KAAOD,EAASE,MAC7B,IAAK,GAED,MADAF,GAASE,KAAO,ECVrCC,EAAAC,MDaiB,KAAK,GAED,MADAJ,GAASE,KAAO,ECbrCG,EAAAC,YDgBiB,KAAK,GCf5BC,EAAAd,QACAe,EAAAC,OACAC,EAAAC,gBAAe,EDkBQ,KAAK,GACL,IAAK,MACD,MAAOX,GAASY,SAG7Bd,EAASH,SArDpB,GASIkB,GAASH,EAASF,EAASD,EAAcF,EAASF,ECJpDW,EASAC,EDbErB,GADeF,GAAaA,EAAUwB,GAC1BrB,MAASA,KAAKD,WAAc,SAAUuB,EAASC,EAAYC,EAAGC,GAC1E,MAAO,KAAKD,IAAMA,EAAIE,UAAU,SAAUC,EAASC,GAC/C,QAASC,GAAUC,GAAS,IAAMC,EAAKN,EAAUlB,KAAKuB,IAAW,MAAOE,GAAKJ,EAAOI,IACpF,QAASC,GAASH,GAAS,IAAMC,EAAKN,EAAAA,SAAgBK,IAAW,MAAOE,GAAKJ,EAAOI,IACpF,QAASD,GAAKG,GAAUA,EAAOC,KAAOR,EAAQO,EAAOJ,OAAS,GAAIN,GAAE,SAAUG,GAAWA,EAAQO,EAAOJ,SAAWM,KAAKP,EAAWI,GACnIF,GAAMN,EAAYA,EAAUY,MAAMf,EAASC,IAAahB,WAchE,QACI+B,SACI,SAAUC,GACNrB,EAAUqB,GAEd,SAAUC,GACNzB,EAAUyB,EACV9B,EAAU8B,GAEd,SAAUC,GACN5B,EAAU4B,GAEd,SAAUC,GACN9B,EAAe8B,GAEnB,SAAUC,GACNnC,EAAOmC,IAEfC,QAAS,WCvBjB,GAVMzB,EAAID,EASJE,EAAgB,EAClByB,aAAaC,QAAQ,kBAAoB1B,EAAe,CD0D5C,GAAI2B,IAA4B,EAC5BC,GAAoB,EACpBC,EAAiBC,MAErB,KC7Df,IAAA,GAA6CC,GAA7CC,EAAmBC,SAASC,OAAOC,MAAM,KAAIC,OAAAC,cAAAV,GAAAI,EAAAC,EAAA7C,QAAA4B,MAAAY,GAAA,EAAE,CD+DxB,GC/DdO,GAAMH,EAAArB,MACR4B,EAAQJ,EAAOK,QAAQ,KAC5BC,EAAOF,EAAQ,GAAKJ,EAAOO,OAAO,EAAGH,GAASJ,CAC/CD,UAASC,OAASM,EAAO,2CDkET,MAAOE,GACLd,GAAoB,EACpBC,EAAiBa,EACnB,QACE,KACSf,GAA6BK,EAAAA,WAC9BA,EAAAA,YAEN,QACE,GAAIJ,EACA,KAAMC,IC1EjCJ,aAAakB,QAAQ,gBAAiB3C,EAAc4C,YAYrDlE","file":"main.js","sourcesContent":["System.register(['./options', './state', './defer', './connection', './db'], function(exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 && context_1.id;\n    var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n        return new (P || (P = Promise))(function (resolve, reject) {\n            function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n            function rejected(value) { try { step(generator.throw(value)); } catch (e) { reject(e); } }\n            function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n            step((generator = generator.apply(thisArg, _arguments)).next());\n        });\n    };\n    var options, state_1, defer_1, connection_1, state_2, db_1;\n    var o, cookieVersion;\n    function start() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield db_1.open();\n            yield state_2.loadFromDB();\n            connection_1.start();\n            defer_1.exec();\n            state_1.displayLoading(false);\n        });\n    }\n    return {\n        setters:[\n            function (options_1) {\n                options = options_1;\n            },\n            function (state_1_1) {\n                state_1 = state_1_1;\n                state_2 = state_1_1;\n            },\n            function (defer_1_1) {\n                defer_1 = defer_1_1;\n            },\n            function (connection_1_1) {\n                connection_1 = connection_1_1;\n            },\n            function (db_1_1) {\n                db_1 = db_1_1;\n            }],\n        execute: function() {\n            o = options;\n            cookieVersion = 4;\n            if (localStorage.getItem(\"cookieVersion\") != cookieVersion) {\n                for (let cookie of document.cookie.split(\";\")) {\n                    const eqPos = cookie.indexOf(\"=\"), name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\n                    document.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT\";\n                }\n                localStorage.setItem(\"cookieVersion\", cookieVersion.toString());\n            }\n            start();\n        }\n    }\n});\n","/*\n  Client entry point.\n  NOTE: All modules use strict mode implicitly\n */\n\n // TODO: Remove, when proper structure done\nimport * as options from './options'\nconst o = options\n\nimport {displayLoading} from './state'\nimport {exec} from './defer'\nimport {start as connect} from './connection'\nimport {loadFromDB} from './state'\nimport {open} from './db'\n\n// Clear cookies, if versions mismatch.\nconst cookieVersion = 4\nif (localStorage.getItem(\"cookieVersion\") != cookieVersion) {\n\tfor (let cookie of document.cookie.split(\";\")) {\n\t\tconst eqPos = cookie.indexOf(\"=\"),\n\t\t\tname = eqPos > -1 ? cookie.substr(0, eqPos) : cookie\n\t\tdocument.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT\"\n\t}\n\tlocalStorage.setItem(\"cookieVersion\", cookieVersion.toString())\n}\n\n// Load all stateful modules in dependancy order\nasync function start() {\n\tawait open()\n\tawait loadFromDB()\n\tconnect()\n\texec()\n\tdisplayLoading(false)\n}\n\nstart()\n"],"sourceRoot":"/source/"}