{"version":3,"sources":["loader.js"],"names":["check","func","eval","e","loadClient","scriptCount","meta","format","System","config","baseURL","defaultJSExtensions","map","underscore","legacy","tests","i","length","window","polyfills","push","head","document","getElementsByTagName","xhr","XMLHttpRequest","open","localStorage","lang","responseType","onload","this","status","Error","response","send","script","createElement","type","src","appendChild"],"mappings":"CAKA,WAEC,QAASA,OAAMC,MACd,IACC,MAAOC,MAAK,eAAiBD,KAAO,SAErC,MAAME,GACL,OAAO,GAqFT,QAASC,cAIR,GADAC,cACoB,IAAhBA,YAAJ,CAMA,GAAIC,KACJA,GAAK,SAAWA,EAAK,UAAYC,OAAQ,YAEzCC,OAAOC,QACNC,QAAS,UACTC,qBAAqB,EACrBC,KACCC,WAAY,yBAEbP,KAAMA,IAGPE,OAAAA,UAAc,MAAQM,OAAS,EAAI,GAAK,UAlEzC,IAAK,GArCDC,QAEH,wBAEA,uEAEA,oEAEA,yCAEA,iDAEA,6DAEA,0DAEA,sCAEA,2DAEA,6KAKA,uCAEA,sEAEA,uEAEA,qFAGA,6CAGQC,EAAI,EAAGA,EAAID,MAAME,OAAQD,IACjC,IAAKhB,MAAMe,MAAMC,IAAK,CACrBE,OAAOJ,QAAS,CAChB,OAIF,GAAIT,aAAc,EACjBc,WAAa,QACbL,OAASI,OAAOJ,MAGbA,SACHK,UAAUC,KAAK,WAAY,QAG5B,IAAIC,MAAOC,SAASC,qBAAqB,QAAQ,EAGjDlB,cACA,IAAImB,KAAM,GAAIC,eACdD,KAAIE,KACH,MACA,cAAgBC,aAAaC,MAAQnB,OAAOmB,KAAPnB,YAAuB,SAE7De,IAAIK,aAAe,OACnBL,IAAIM,OAAS,WACZ,GAAoB,MAAhBC,KAAKC,OACR,KAAM,IAAIC,OAAM,iCAAmCF,KAAKC,OAEzDd,QAAOU,KAAOG,KAAKG,SACnB9B,cAEDoB,IAAIW,MAEJ,KAAK,GAAInB,GAAI,EAAGA,EAAIG,UAAUF,OAAQD,IAAK,CAC1CX,aACA,IAAI+B,QAASd,SAASe,cAAc,SACpCD,QAAOE,KAAO,kBACdF,OAAOG,IAAM,kBAAoBpB,UAAUH,GAAK,MAChDoB,OAAON,OAAS1B,WAChBiB,KAAKmB,YAAYJ","file":"loader.js","sourcesContent":["/*\n Selects and loads the client files\n Use only pure ES5.\n*/\n\n(function () {\n\t// Check for browser compatibility by trying to detect some ES6 features\n\tfunction check(func) {\n\t\ttry {\n\t\t\treturn eval('(function(){' + func + '})();')\n\t\t}\n\t\tcatch(e) {\n\t\t\treturn false\n\t\t}\n\t}\n\n\tvar tests = [\n\t\t// Arrow functions\n\t\t'return (()=>5)()===5;',\n\t\t// Block scopped const\n\t\t'\"use strict\";  const bar = 123; {const bar = 456;} return bar===123;',\n\t\t// Block-scoped let\n\t\t'\"use strict\"; let bar = 123;{ let bar = 456; }return bar === 123;',\n\t\t// Computed object properties\n\t\t\"var x='y';return ({ [x]: 1 }).y === 1;\",\n\t\t// Shorthand object properties\n\t\t\"var a=7,b=8,c={a,b};return c.a===7 && c.b===8;\",\n\t\t// Template strings\n\t\t'var a = \"ba\"; return `foo bar${a + \"z\"}` === \"foo barbaz\";',\n\t\t// for...of\n\t\t'var arr = [5]; for (var item of arr) return item === 5;',\n\t\t// Spread operator\n\t\t'return Math.max(...[1, 2, 3]) === 3',\n\t\t// Class statement\n\t\t'\"use strict\"; class C {}; return typeof C === \"function\"',\n\t\t// Super call\n\t\t'\"use strict\"; var passed = false;'\n\t\t\t+ 'class B {constructor(a) {  passed = (a === \"barbaz\")}};'\n\t\t\t+ 'class C extends B {constructor(a) {super(\"bar\" + a)}};'\n\t\t\t+ 'new C(\"baz\"); return passed;',\n\t\t// Promises\n\t\t'return typeof Promise === \"function\"',\n\t\t// Default parameters\n\t\t'return (function (a = 1, b = 2) { return a === 3 && b === 2; }(3));',\n\t\t// Destructuring decliration\n\t\t'var [a,,[b],c] = [5,null,[6]];return a===5 && b===6 && c===undefined',\n\t\t// Parameter destructuring\n\t\t'return function([a,,[b],c]){return a===5 && b===6 && c===undefined;}'\n\t\t\t+ '([5,null,[6]])',\n\t\t// Fetch API\n\t\t'return typeof window.fetch === \"function\"'\n\t]\n\n\tfor (var i = 0; i < tests.length; i++) {\n\t\tif (!check(tests[i])) {\n\t\t\twindow.legacy = true\n\t\t\tbreak\n\t\t}\n\t}\n\n\tvar scriptCount = 0,\n\t\tpolyfills = ['dom4'],\n\t\tlegacy = window.legacy\n\n\t// Stuff them full of hot, fat and juicy polyfills, if even one test failed.\n\tif (legacy) {\n\t\tpolyfills.push('core.min', 'fetch')\n\t}\n\n\tvar head = document.getElementsByTagName('head')[0]\n\n\t// Load apropriate language pack\n\tscriptCount++\n\tvar xhr = new XMLHttpRequest()\n\txhr.open(\n\t\t'GET',\n\t\t'/ass/lang/' + (localStorage.lang || config.lang.default) + '.json'\n\t)\n\txhr.responseType = 'json'\n\txhr.onload = function () {\n\t\tif (this.status !== 200) {\n\t\t\tthrow new Error(\"Error fetching language pack: \" + this.status)\n\t\t}\n\t\twindow.lang = this.response\n\t\tloadClient()\n\t}\n\txhr.send()\n\n\tfor (var i = 0; i < polyfills.length; i++) {\n\t\tscriptCount++\n\t\tvar script = document.createElement('script')\n\t\tscript.type = 'text/javascript'\n\t\tscript.src = '/ass/js/vendor/' + polyfills[i] + '.js'\n\t\tscript.onload = loadClient\n\t\thead.appendChild(script)\n\t}\n\n\tfunction loadClient() {\n\t\t// This function might be called multiple times. Only load the client,\n\t\t// when all polyfills are loaded.\n\t\tscriptCount--\n\t\tif (scriptCount !== 0) {\n\t\t\treturn\n\t\t}\n\n\t\t// Load all client modules as precompiled System.register format\n\t\t// modules\n\t\tvar meta = {}\n\t\tmeta['es5/*'] = meta['es6/*'] = {format: 'register'}\n\n\t\tSystem.config({\n\t\t\tbaseURL: '/ass/js',\n\t\t\tdefaultJSExtensions: true,\n\t\t\tmap: {\n\t\t\t\tunderscore: 'vendor/underscore-min'\n\t\t\t},\n\t\t\tmeta: meta\n\t\t})\n\n\t\tSystem.import('es' + (legacy ? 5 : 6) + '/main')\n\t}\n})()\n"],"sourceRoot":"/source/"}