{"version":3,"sources":["options/view.ts"],"names":[],"mappings":"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","file":"options/view.js","sourcesContent":["import {BannerModal} from '../modal'\nimport renderContents from './render'\nimport {models, default as options} from '../options'\nimport {optionType} from './specs'\nimport {each, find} from 'underscore'\nimport {onceAll} from '../util'\nimport {opts as lang} from '../lang'\n\n// View of the options panel\nexport default class OptionsPanel extends BannerModal {\n\t$hidden: Element\n\n\tconstructor() {\n\t\tsuper({id: 'options-panel'})\n\t\tthis.onClick({\n\t\t\t'.tab_link': e => this.switchTab(e),\n\t\t\t'#export': () => this.exportConfigs(),\n\t\t\t'#import': e => this.importConfigs(e),\n\t\t\t'#hidden': () => this.clearHidden()\n\t\t})\n\t\tthis.onAll('change', e => this.applyChange(e))\n\t}\n\n\t// Render the contents of the options panel and insert it into the DOM\n\trender() {\n\t\tthis.el.innerHTML = renderContents()\n\t\tthis.assignValues()\n\t\tthis.$hidden = this.el.query('#hidden')\n\n\t\t// TODO: Hidden posts count rendering\n\t\t// events.reply('hide:render', this.renderHidden, this)\n\t}\n\n\t// Assign loaded option settings to the respective elements in the options\n\t// panel\n\tassignValues() {\n\t\tfor (let id in models) {\n\t\t\tconst model = models[id],\n\t\t\t\tel = this.el.query('#' + id),\n\t\t\t\tval = model.get()\n\t\t\tswitch (model.spec.type) {\n\t\t\tcase optionType.checkbox:\n\t\t\t\tel.checked = val as boolean\n\t\t\t\tbreak\n\t\t\tcase optionType.number:\n\t\t\tcase optionType.menu:\n\t\t\t\tel.value = val\n\t\t\t\tbreak\n\t\t\tcase optionType.shortcut:\n\t\t\t\tel.value = String.fromCharCode(val as number).toUpperCase()\n\t\t\t\tbreak\n\t\t\t}\n\t\t\t// 'image' type simply falls through, as those don't need to be set\n\t\t}\n\t}\n\n\t// Propagate options panel changes through\n\t// options-panel -> options -> OptionModel\n\tapplyChange(event: Event) {\n\t\tconst el = event.target as Element,\n\t\t\tid = el.getAttribute('id'),\n\t\t\tmodel = models[id]\n\t\tlet val: boolean|string|number\n\t\tswitch (model.spec.type) {\n\t\tcase optionType.checkbox:\n\t\t\tval = el.checked\n\t\t\tbreak\n\t\tcase optionType.number:\n\t\t\tval = parseInt(el.value)\n\t\t\tbreak\n\t\tcase optionType.menu:\n\t\t\tval = el.value\n\t\t\tbreak\n\t\tcase optionType.shortcut:\n\t\t\tval = el.value.toUpperCase().charCodeAt(0)\n\t\t\tbreak\n\n\t\t/*\n\t\tTODO: System.import().then()\n\t\tcase 'image':\n\t\t\t// Not recorded. Extracted directly by the background handler.\n\t\t\treturn events.request('background:store', event.target)\n\t\t*/\n\t\t}\n\n\t\tif (!model.validate(val)) {\n\t\t\tel.value = ''\n\t\t} else {\n\t\t\toptions.set(id, val)\n\t\t}\n\t}\n\n\t// Switch to a tab, when clicking the tab butt\n\tswitchTab(event: Event) {\n\t\tevent.preventDefault()\n\t\tconst el = event.target as Element\n\n\t\t// Deselect previous tab\n\t\teach(this.el.children, el =>\n\t\t\tel.query('.tab_sel').classList.remove('tab_sel'))\n\n\t\t// Select the new one\n\t\tel.classList.add('tab_sel')\n\t\tfind(this.el.lastChild.children, li =>\n\t\t\tli.classList.contains(el.getAttribute('data-content'))\n\t\t)\n\t\t\t.classList.add('tab_sel')\n\t}\n\n\t// Dump options to JSON file and upload to user\n\texportConfigs() {\n\t\tconst a = document.getElementById('export')\n\t\tconst blob = new Blob([JSON.stringify(localStorage)], {\n\t\t\ttype: 'octet/stream'\n\t\t})\n\t\ta.setAttribute('href', window.URL.createObjectURL(blob))\n\t\ta.setAttribute('download', 'meguca-config.json')\n\t}\n\n\t// Import options from uploaded JSON file\n\timportConfigs(event: Event) {\n\t\t// Proxy to hidden file input\n\t\tevent.preventDefault()\n\t\tconst el = document.query('#importSettings')\n\t\tel.click()\n\t\tonceAll(el, 'change', () => {\n\t\t\tconst reader = new FileReader()\n\t\t\treader.readAsText(el.files[0])\n\t\t\treader.onload = event => {\n\t\t\t\tevent as FileReaderOnloadEvent\n\n\t\t\t\t// In case of curruption\n\t\t\t\tlet json: {[key: string]: string}\n\t\t\t\ttry {\n\t\t\t\t\tjson = JSON.parse(event.target.result)\n\t\t\t\t}\n\t\t\t\tcatch(err) {\n\t\t\t\t\talert(lang.importConfig.corrupt)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlocalStorage.clear()\n\t\t\t\tfor (let key in json) {\n\t\t\t\t\tlocalStorage.setItem(key, json[key])\n\t\t\t\t}\n\t\t\t\talert(lang.importConfig.done)\n\t\t\t\tlocation.reload()\n\t\t\t}\n\t\t})\n\t}\n\n\t// Render Hiden posts counter\n\trenderHidden(count: number) {\n\t\tconst el = this.$hidden\n\t\tel.textContent = el.textContent.replace(/\\d+$/, count.toString())\n\t}\n\n\t// Clear displayed hidden post counter\n\tclearHidden() {\n\n\t\t// TODO: Fix  after psot hiding ported\n\t\t// main.request('hide:clear')\n\n\t\tthis.renderHidden(0)\n\t}\n}\n\n// Highlight options button by fading out and in, if no options are set\n(function() {\n\tif (localStorage.getItem('optionsSeen')) {\n\t\treturn\n\t}\n\tconst el = document.query('#options')\n\tel.style.opacity = '1'\n\tlet out = true,\n\t\tclicked: boolean\n\tel.addEventListener(\"click\", () => {\n\t\tclicked = true\n\t\tlocalStorage.setItem('optionsSeen', '1')\n\t})\n\ttick()\n\n\tfunction tick() {\n\t\t// Stop\n\t\tif (clicked) {\n\t\t\tel.style.opacity = '1'\n\t\t\treturn\n\t\t}\n\n\t\tel.style.opacity = (+el.style.opacity + (out ? -0.02 : 0.02)).toString()\n\t\tconst now = +el.style.opacity\n\n\t\t// Reverse direction\n\t\tif ((out && now <= 0) || (!out && now >= 1)) {\n\t\t\tout = !out\n\t\t}\n\t\trequestAnimationFrame(tick)\n\t}\n})()\n"],"sourceRoot":"/source/"}